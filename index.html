<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Baikal1-blockingу</title>

  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="lib/RGBELoader.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  
  <script src="lib/reset-on-collision.js"></script>
  <script src="components/aframe-orbit-controls.js"></script>
  <script src="components/aframe-env-map-component.js"></script>
  <script src="components/aframe-hdr-environment.js"></script>

  <style>
    body { margin: 0; }
    .hint { position: absolute; top: 8px; left: 8px; padding: 6px 10px; background: rgba(0,0,0,0.5); color:#fff; font-size:13px; border-radius:4px;}
  </style>
</head>
<body>
  <div class="hint">WASD + мышь для управления. Ctrl+Alt+I — инспектор.</div>
  
  <a-scene light="defaultLightsEnabled: false" hdr-environment="url: assets/skybox2.hdr; showBackground: true; showGround: true; groundSize: 1500">
    <a-assets> 
      <asset-item id="tree" src="assets/low_poly_tree_wind.glb"></asset-item>
      <asset-item id="rabbit" src="assets/low_poly_rabbit.glb"></asset-item>
      <asset-item id="deer" src="assets/low_poly_deer.glb"></asset-item>
    </a-assets>
    <!-- 3D models -->
    <a-entity id="treeModel" gltf-model="#tree" animation-mixer="loop: repeat" scale="0.04 0.05 0.015" position="21 0.5 -23.65063">
      <!-- Вместо кривого куба коллизии модели кастомный куб -->
      <a-box id="collisionBoxTree" scale="1.5 1.5 1.5" position="0 38 0" depth="50" height="75" width="20" visible="false" class="collision"></a-box> 
    </a-entity>
    <a-entity id="rabbitModel" gltf-model="#rabbit" animation-mixer="clip: Armature.001|Idle; loop: repeat"scale="0.3 0.3 0.3" position="-3 0.5 -10" rotation="0 -15 0" class="collision"></a-entity>
    <a-entity id="deerModel" gltf-model="#deer" animation-mixer="clip: Armature|Eat; loop: repeat" scale="1 1 1" position="20 0.5 -26.58501" rotation="0 15 0" class="collision"></a-entity>
    
    <!-- Поверхности (лёд/снег/туман) -->
    <a-plane id="lakeSurface" geometry="primitive: box" rotation="-90 0 0" width="60" height="60"
             material="color: #9cc6ec; roughness: 0.7; metalness: 1; opacity: 0.6; transparent: true; depthTest: true; side: double"
             position="0 0 50"></a-plane>
    <a-plane id="groundSurface" scale="1 1 1" geometry="primitive: box; depth: 2; height: 90" rotation="-90 0 0" width="60" height="60"
             material="color: #b8d7ff; roughness: 0.8; metalness: 0.2; opacity: 1; transparent: true; fog: false"
             position="0 -0.4816 -25"></a-plane>
    <a-plane id="fogSurface0" scale="10 15 5" geometry="primitive: sphere; segmentsWidth: 6" rotation="-90 0 0" width="60" height="60"
             material="color: #b8d7ff; roughness: 0.8; metalness: 0.2; opacity: 0.5; transparent: true"
             position="-10.56024 7.05674 -36.84164"></a-plane>
    <a-plane id="fogSurface1" scale="15 10 5" geometry="primitive: sphere; segmentsWidth: 6" rotation="-90 0 0" width="60" height="60"
             material="color: #b8d7ff; roughness: 0.8; metalness: 0.2; opacity: 0.5; transparent: true"
             position="-3.55765 15.18178 -44.31926"></a-plane> 
    <a-plane id="fogSurface2" scale="12 12 5" geometry="primitive: sphere; segmentsWidth: 6" rotation="-90 0 0" width="60" height="60"
             material="color: #b8d7ff; roughness: 0.8; metalness: 0.2; opacity: 0.5; transparent: true"
             position="10.40466 7.9516 -36.57555"></a-plane>
    <a-plane id="fogWater" visible="true" scale="1 1 5" geometry="primitive: box; segmentsWidth: 6" rotation="-90 0 0" width="60" height="60"
             material="color: #b8d7ff; roughness: 0.8; metalness: 0.2; opacity: 0.5; transparent: true; visible: true; side: double; depthTest: true; depthWrite: true; fog: true; flatShading: false"
             position="0 3.5 65.59598"></a-plane>
    <a-plane id="water" scale="1 1 5" geometry="primitive: box; segmentsWidth: 6" rotation="-90 0 0" width="60" height="60"
             material="color: #6babff; roughness: 0.8; metalness: 0.2; opacity: 1; transparent: false; visible: true; alphaTest: 0; fog: true; side: double"
             position="0 -3 35"></a-plane>                                                                     

    <!-- Скалы/берег -->
    <a-box id="rock0" geometry="height: 20; width: 10; depth: 8" material="color: #7c756e" position="-1.54505 7.7486 -43.4083" depth="2" width="10" height="4" color="#8B7D7B" class="collision">
      <a-box id="lilrock0" geometry="width: 10; height: 15; depth: 7" material="color: #7c756e" position="-7.20579 -2.11174 2.90727" depth="2" width="10" height="4" color="#8B7D7B" class="collision"></a-box>
      <a-box id="lilrock1" geometry="depth: 5; height: 10; width: 7" position="0.55012 13.8052 -0.68011" material="color: #7c756e"></a-box>
      <a-box id="lilrock2" geometry="depth: 6; height: 15; width: 8" position="7.37006 -0.02435 -0.14172" material="color: #7c756e"></a-box>
      <a-box id="lilrock3" geometry="height: 12" material="color: #7c756e" position="6.7837 -1.1688 4.48303" depth="3" width="5" height="6" color="#7f7f7f" class="collision"></a-box>
      <a-box id="lilrock4" geometry="width: 8; height: 15; depth: 6" material="color: #7c756e" position="0.23492 -1.90914 7.66073" depth="2" width="4" height="3" color="#6e6e6e" class="collision"></a-box>
    </a-box>

    <a-cone id="rock1" geometry="radiusBottom: 10; segmentsHeight: 18; height: 30; segmentsRadial: 4" geometry= "segmentsRadial: 4" scale="1 1 0.5" material="color: #7c756e; flatShading: true" position="-12 14 -55" depth="2" width="4" height="3" color="#6e6e6e" class="collision"></a-cone>
    <a-cone id="rock2" geometry="radiusBottom: 10; segmentsHeight: 18; height: 21; segmentsRadial: 4" geometry= "segmentsRadial: 4" scale="1 1 0.7" material="color: #7c756e; flatShading: true" position="13.67606 10.81715 -52.3457" depth="2" width="4" height="3" color="#6e6e6e" class="collision"></a-cone>

    <!-- Типа чаща из далека -->
    <a-box id="miniWood1" rotation="0 0 0" geometry="width: 8; height: 10; depth: 8" material="color: #4c5a3a" position="4.02364 -3.38763 -29.35228" depth="2" width="4" height="3" color="#6e6e6e" class="collision"></a-box>
    <a-box id="miniWood2" geometry="width: 8; height: 3; depth: 6" material="color: #4c5a3a" position="-7.20349 -0.13282 -29.43148" depth="2" width="4" height="3" color="#6e6e6e" class="collision"></a-box>

    <!-- Деревья -->
    <a-cylinder id="treeTrunk1" material="color: #4e443b; roughness: 0.85" geometry="segmentsRadial: 3" position="-8.76446 1 -24.09229" radius="0.2" height="2" color="#5a381e" class="collision">
      <a-cone id="treeLeaves1" material="color: #466755; roughness: 0.85" scale="1 1 1" geometry="segmentsWidth: 3; segmentsRadial: 3; height: 5" position="0 3.5 0" radius="1" color="#2e8b57"></a-cone>
    </a-cylinder>
    <a-cylinder id="treeTrunk2" material="color: #4e443b; roughness: 0.85" geometry="segmentsRadial: 3" position="-6.04191 1 -20.15475" radius="0.2" height="2" color="#5a381e" class="collision">
      <a-cone id="treeLeaves2" material="color: #466755; roughness: 0.85" scale="1 1 1" geometry="segmentsWidth: 3; segmentsRadial: 3; height: 5" position="0 3.5 0" radius="1" color="#2e8b57"></a-cone>
    </a-cylinder>
    <a-cylinder id="treeTrunk3" material="color: #4e443b; roughness: 0.85" geometry="segmentsRadial: 3" position="4.17304 1 -21.35939" radius="0.2" height="2" color="#5a381e" class="collision">
      <a-cone id="treeLeaves3" material="color: #466755; roughness: 0.85" scale="1 1 1" geometry="segmentsWidth: 3; segmentsRadial: 3; height: 5" position="0 3.5 0" radius="1" color="#2e8b57"></a-cone>
    </a-cylinder>
    <a-cylinder id="treeTrunk4" material="color: #4e443b; roughness: 0.85" geometry="segmentsRadial: 3" position="9.71894 1 -22.3125" radius="0.2" height="2" color="#5a381e" class="collision">
      <a-cone id="treeLeaves4" material="color: #466755; roughness: 0.85" scale="1 1 1" geometry="segmentsWidth: 3; segmentsRadial: 3; height: 5" position="0 3.5 0" radius="1" color="#2e8b57"></a-cone>
    </a-cylinder>
    <a-cylinder id="treeTrunk5" material="color: #4e443b; roughness: 0.85" geometry="segmentsRadial: 3" position="6.87173 1 -18.40522" radius="0.2" height="2" color="#5a381e" class="collision">
      <a-cone id="treeLeaves5" material="color: #466755; roughness: 0.85" scale="1 1 1" geometry="segmentsWidth: 3; segmentsRadial: 3; height: 5" position="0 3.5 0" radius="1" color="#2e8b57"></a-cone>
    </a-cylinder>

    <!-- Кубы коллизии/границы -->
     <a-box id="cllsnCube0" geometry="height: 5; width: 1; depth: 130" position="30 3 25.76562" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube1" geometry="height: 5; width: 30; depth: 1" position="16.21193 3 -38.47529" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube2" geometry="height: 5; width: 20; depth: 1" position="-23.11438 3 -43.09944" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube3" geometry="height: 5; width: 1; depth: 130" position="-30 3 21.56421" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube4" geometry="height: 5; width: 60; depth: 1" position="0 3 86.47475" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube5" geometry="height: 5; width: 10; depth: 8" position="-1.54505 17.31806 -27.86194" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube6" geometry="height: 5; width: 10; depth: 8" position="-1.54505 18.45354 -14.39617" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
     <a-box id="cllsnCube7" geometry="height: 5; width: 10; depth: 8" position="-1.54505 19.92326 -1.86539" depth="2" width="10" height="4" visible="false" class="collision"></a-box>
    <!-- Камера -->
    <a-entity id="rig" position="0 1.7 0">
      <a-entity id="playerCam"
            camera
            look-controls
            wasd-controls
            geometry="primitive: box; width: 0.5; height: 1.7; depth: 0.5; visible: false"
            reset-on-collision="with: .collision; colliderSize: 0.6; smoothRecovery: true">
        <a-entity id="cursor"
              cursor="rayOrigin: mouse"
              position="0 0 -1"
              geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.01"
              material="shader: flat; color: #fff">
        </a-entity>
      </a-entity>
    </a-entity>

  </a-scene>
</body>
</html>
